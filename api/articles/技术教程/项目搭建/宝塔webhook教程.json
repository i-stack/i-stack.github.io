{"title":"宝塔webhook教程","slug":"技术教程/项目搭建/宝塔webhook教程","date":"2023-03-05T07:48:35.000Z","updated":"2023-05-05T14:55:02.790Z","comments":true,"path":"api/articles/技术教程/项目搭建/宝塔webhook教程.json","excerpt":null,"covers":["/posts/cbb9f542/1678089469259.jpg","/posts/cbb9f542/1678090086470.jpg","/posts/cbb9f542/1678089296251.jpg","/posts/cbb9f542/1678090787544.jpg","/posts/cbb9f542/1678090526810.jpg","/posts/cbb9f542/1678091013348.jpg","/posts/cbb9f542/1678091276007.jpg"],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"/assets/css/APlayer.min.css\"><script src=\"/assets/js/APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"/assets/js/Meting.min.js\"></script><h2 id=\"实现的效果\"><a href=\"#实现的效果\" class=\"headerlink\" title=\"实现的效果\"></a>实现的效果</h2><p>通过 <code>git</code> 的 <code>webhook</code> 触发 <code>push</code> 事件 ，用户提交代码后 <code>(git push)</code> ，服务器直接拉取当前 <code>git</code> 最新代码。</p>\n<h2 id=\"安装部署\"><a href=\"#安装部署\" class=\"headerlink\" title=\"安装部署\"></a>安装部署</h2><p>1、假定服务器已经安装 <code>git</code>，<code>宝塔面板</code></p>\n<p>2、登录宝塔面板 -&gt; 软件商店 -&gt; 搜索 webhook，点击安装安装</p>\n<p><img src=\"/posts/cbb9f542/1678089469259.jpg\" alt=\"2\"></p>\n<p>3、通过 <code>webhook</code> 添加 <code>shell</code> 命令，直接复制代码到执行脚本</p>\n<p><img src=\"/posts/cbb9f542/1678090086470.jpg\" alt=\"3\"></p>\n<figure class=\"highlight plaintext\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/bin/bash</span><br><span class=\"line\">echo \"\"</span><br><span class=\"line\">#输出当前时间</span><br><span class=\"line\">date --date='0 days ago' \"+%Y-%m-%d %H:%M:%S\"</span><br><span class=\"line\">echo \"Start\"</span><br><span class=\"line\">#git分支名称</span><br><span class=\"line\">branch=\"master\"</span><br><span class=\"line\">#服务器项目路径</span><br><span class=\"line\">gitPath=\"/www/wwwroot/freelibrary\"</span><br><span class=\"line\">#git 仓库地址</span><br><span class=\"line\">gitHttp=\"git@github.com:i-stack/i-stack.github.io.git\"</span><br><span class=\"line\">#gitHttp=\"http://192.168.2.20/llh/$1.git\" //多仓库的时候</span><br><span class=\"line\">echo \"Web站点路径：$gitPath\"</span><br><span class=\"line\">#判断项目路径是否存在</span><br><span class=\"line\">if [ -d \"$gitPath\" ]; then</span><br><span class=\"line\">cd $gitPath</span><br><span class=\"line\">#判断是否存在git目录</span><br><span class=\"line\">if [ ! -d \".git\" ]; then</span><br><span class=\"line\">echo \"在该目录下克隆 git\"</span><br><span class=\"line\">sudo git clone $gitHttp gittemp</span><br><span class=\"line\">sudo mv gittemp/.git .</span><br><span class=\"line\">sudo rm -rf gittemp</span><br><span class=\"line\">fi</span><br><span class=\"line\">echo \"拉取最新的项目文件\"</span><br><span class=\"line\">#sudo git reset --hard origin/$branch</span><br><span class=\"line\">git remote add origin $gitHttp</span><br><span class=\"line\">git branch --set-upstream-to=origin/$branch $branch</span><br><span class=\"line\">sudo git reset --hard origin/$branch</span><br><span class=\"line\">sudo git pull $gitHttp 2&gt;&amp;1</span><br><span class=\"line\">echo \"设置目录权限\"</span><br><span class=\"line\">sudo chown -R www:www $gitPath</span><br><span class=\"line\">echo \"End\"</span><br><span class=\"line\">exit</span><br><span class=\"line\">else</span><br><span class=\"line\">echo \"该项目路径不存在\"</span><br><span class=\"line\">echo \"新建项目目录\"</span><br><span class=\"line\">mkdir $gitPath</span><br><span class=\"line\">cd $gitPath</span><br><span class=\"line\">#判断是否存在git目录</span><br><span class=\"line\">if [ ! -d \".git\" ]; then</span><br><span class=\"line\">echo \"在该目录下克隆 git\"</span><br><span class=\"line\">sudo git clone $gitHttp gittemp</span><br><span class=\"line\">sudo mv gittemp/.git .</span><br><span class=\"line\">sudo rm -rf gittemp</span><br><span class=\"line\">fi</span><br><span class=\"line\">echo \"拉取最新的项目文件\"</span><br><span class=\"line\">#sudo git reset --hard origin/$branch</span><br><span class=\"line\">sudo git pull gitHttp 2&gt;&amp;1</span><br><span class=\"line\">echo \"设置目录权限\"</span><br><span class=\"line\">sudo chown -R www:www $gitPath</span><br><span class=\"line\">echo \"End\"</span><br><span class=\"line\">exit</span><br><span class=\"line\">fi</span><br></pre></td></tr></tbody></table></figure>\n\n<p>复制完成之后先点击提交，然后在编辑页面修改。</p>\n<p>需要修改的地方：在第7行，第9行，第11行。</p>\n<p>第7行：修改成git 仓库上的分支名</p>\n<p>第9行：服务器项目路径，这个是自己的服务器项目地址</p>\n<p>第11行：代码在 git 仓库上的地址</p>\n<p>修改完成后，记得保存！此时界面展示</p>\n<p><img src=\"/posts/cbb9f542/1678089296251.jpg\" alt=\"1\"></p>\n<p>4、查看密钥</p>\n<p><img src=\"/posts/cbb9f542/1678090787544.jpg\" alt=\"4\"></p>\n<p>显示密钥界面出现后，不要关闭，然后打开github</p>\n<p><img src=\"/posts/cbb9f542/1678090526810.jpg\" alt=\"5\"></p>\n<p><img src=\"/posts/cbb9f542/1678091013348.jpg\" alt=\"6\"></p>\n<p>输入完后点击 <code>Add webhook</code> 按钮即可。到此 <code>webhook</code> 已经部署完成！下面开始验证</p>\n<h2 id=\"验证webhook自动更新代码\"><a href=\"#验证webhook自动更新代码\" class=\"headerlink\" title=\"验证webhook自动更新代码\"></a>验证webhook自动更新代码</h2><p>1、宝塔webhook验证：</p>\n<p><img src=\"/posts/cbb9f542/1678091276007.jpg\" alt=\"7\"></p>\n<p>日志没有报错，说明所有环节都已经成功！</p>\n<p>2、代码push测试：</p>\n<p>修改自己的代码，执行 <code>push</code> 操作，然后到服务器上查看代码是否自动更新！</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>1、按照教程步骤，一步一步操作，一次成功！</p>\n<p>2、如果失败，多看日志！也可以留言！</p>\n","more":"<h2 id=\"实现的效果\"><a href=\"#实现的效果\" class=\"headerlink\" title=\"实现的效果\"></a>实现的效果</h2><p>通过 <code>git</code> 的 <code>webhook</code> 触发 <code>push</code> 事件 ，用户提交代码后 <code>(git push)</code> ，服务器直接拉取当前 <code>git</code> 最新代码。</p>\n<h2 id=\"安装部署\"><a href=\"#安装部署\" class=\"headerlink\" title=\"安装部署\"></a>安装部署</h2><p>1、假定服务器已经安装 <code>git</code>，<code>宝塔面板</code></p>\n<p>2、登录宝塔面板 -&gt; 软件商店 -&gt; 搜索 webhook，点击安装安装</p>\n<p><img src=\"/posts/cbb9f542/1678089469259.jpg\" alt=\"2\"></p>\n<p>3、通过 <code>webhook</code> 添加 <code>shell</code> 命令，直接复制代码到执行脚本</p>\n<p><img src=\"/posts/cbb9f542/1678090086470.jpg\" alt=\"3\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/bin/bash</span><br><span class=\"line\">echo &quot;&quot;</span><br><span class=\"line\">#输出当前时间</span><br><span class=\"line\">date --date=&#x27;0 days ago&#x27; &quot;+%Y-%m-%d %H:%M:%S&quot;</span><br><span class=\"line\">echo &quot;Start&quot;</span><br><span class=\"line\">#git分支名称</span><br><span class=\"line\">branch=&quot;master&quot;</span><br><span class=\"line\">#服务器项目路径</span><br><span class=\"line\">gitPath=&quot;/www/wwwroot/freelibrary&quot;</span><br><span class=\"line\">#git 仓库地址</span><br><span class=\"line\">gitHttp=&quot;git@github.com:i-stack/i-stack.github.io.git&quot;</span><br><span class=\"line\">#gitHttp=&quot;http://192.168.2.20/llh/$1.git&quot; //多仓库的时候</span><br><span class=\"line\">echo &quot;Web站点路径：$gitPath&quot;</span><br><span class=\"line\">#判断项目路径是否存在</span><br><span class=\"line\">if [ -d &quot;$gitPath&quot; ]; then</span><br><span class=\"line\">cd $gitPath</span><br><span class=\"line\">#判断是否存在git目录</span><br><span class=\"line\">if [ ! -d &quot;.git&quot; ]; then</span><br><span class=\"line\">echo &quot;在该目录下克隆 git&quot;</span><br><span class=\"line\">sudo git clone $gitHttp gittemp</span><br><span class=\"line\">sudo mv gittemp/.git .</span><br><span class=\"line\">sudo rm -rf gittemp</span><br><span class=\"line\">fi</span><br><span class=\"line\">echo &quot;拉取最新的项目文件&quot;</span><br><span class=\"line\">#sudo git reset --hard origin/$branch</span><br><span class=\"line\">git remote add origin $gitHttp</span><br><span class=\"line\">git branch --set-upstream-to=origin/$branch $branch</span><br><span class=\"line\">sudo git reset --hard origin/$branch</span><br><span class=\"line\">sudo git pull $gitHttp 2&gt;&amp;1</span><br><span class=\"line\">echo &quot;设置目录权限&quot;</span><br><span class=\"line\">sudo chown -R www:www $gitPath</span><br><span class=\"line\">echo &quot;End&quot;</span><br><span class=\"line\">exit</span><br><span class=\"line\">else</span><br><span class=\"line\">echo &quot;该项目路径不存在&quot;</span><br><span class=\"line\">echo &quot;新建项目目录&quot;</span><br><span class=\"line\">mkdir $gitPath</span><br><span class=\"line\">cd $gitPath</span><br><span class=\"line\">#判断是否存在git目录</span><br><span class=\"line\">if [ ! -d &quot;.git&quot; ]; then</span><br><span class=\"line\">echo &quot;在该目录下克隆 git&quot;</span><br><span class=\"line\">sudo git clone $gitHttp gittemp</span><br><span class=\"line\">sudo mv gittemp/.git .</span><br><span class=\"line\">sudo rm -rf gittemp</span><br><span class=\"line\">fi</span><br><span class=\"line\">echo &quot;拉取最新的项目文件&quot;</span><br><span class=\"line\">#sudo git reset --hard origin/$branch</span><br><span class=\"line\">sudo git pull gitHttp 2&gt;&amp;1</span><br><span class=\"line\">echo &quot;设置目录权限&quot;</span><br><span class=\"line\">sudo chown -R www:www $gitPath</span><br><span class=\"line\">echo &quot;End&quot;</span><br><span class=\"line\">exit</span><br><span class=\"line\">fi</span><br></pre></td></tr></table></figure>\n\n<p>复制完成之后先点击提交，然后在编辑页面修改。</p>\n<p>需要修改的地方：在第7行，第9行，第11行。</p>\n<p>第7行：修改成git 仓库上的分支名</p>\n<p>第9行：服务器项目路径，这个是自己的服务器项目地址</p>\n<p>第11行：代码在 git 仓库上的地址</p>\n<p>修改完成后，记得保存！此时界面展示</p>\n<p><img src=\"/posts/cbb9f542/1678089296251.jpg\" alt=\"1\"></p>\n<p>4、查看密钥</p>\n<p><img src=\"/posts/cbb9f542/1678090787544.jpg\" alt=\"4\"></p>\n<p>显示密钥界面出现后，不要关闭，然后打开github</p>\n<p><img src=\"/posts/cbb9f542/1678090526810.jpg\" alt=\"5\"></p>\n<p><img src=\"/posts/cbb9f542/1678091013348.jpg\" alt=\"6\"></p>\n<p>输入完后点击 <code>Add webhook</code> 按钮即可。到此 <code>webhook</code> 已经部署完成！下面开始验证</p>\n<h2 id=\"验证webhook自动更新代码\"><a href=\"#验证webhook自动更新代码\" class=\"headerlink\" title=\"验证webhook自动更新代码\"></a>验证webhook自动更新代码</h2><p>1、宝塔webhook验证：</p>\n<p><img src=\"/posts/cbb9f542/1678091276007.jpg\" alt=\"7\"></p>\n<p>日志没有报错，说明所有环节都已经成功！</p>\n<p>2、代码push测试：</p>\n<p>修改自己的代码，执行 <code>push</code> 操作，然后到服务器上查看代码是否自动更新！</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>1、按照教程步骤，一步一步操作，一次成功！</p>\n<p>2、如果失败，多看日志！也可以留言！</p>\n","categories":[{"name":"技术教程","path":"api/categories/技术教程.json"}],"tags":[{"name":"宝塔面板","path":"api/tags/宝塔面板.json"}]}